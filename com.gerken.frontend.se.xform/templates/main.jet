<%-- Entry point for transformation com.gerken.frontend.se.xform --%>
<%-- 
  IMPORTANT: MACHINE GENERATED! DO NOT MODIFY, EXCEPT IN DESIGNATED LOCATIONS
  
  This template is generated by the JET Authoring editor. Do not modify it, except in areas
  where comments indicate. Modifications in other areas will be lost when the JET Authoring edit
  'Update Project' action is invoked.
--%>

<%--
  This template has two phases:
  1) it traverses the input model, and computes 'derived attributes' creating an 'annotated input model'.
  2) it traverses the annotated input model, and performs transformation actions such as creating projects, folders and files
  
  The template includes user regions where customizations may be added:
  1) custom derived attribute calculations may be added in three locations for each block of attributes:
    a) before the block of generated calculations
    b) after the block of generated calculations
    c) after all child calculations have been performed
  2) custom processing may be added
    a) before the input annotation phase
    b) after the input annotation phase
    c) after the action phase. 
--%>


<%@taglib id="org.eclipse.jet.workspaceTags" prefix="ws"%>

<%-- Define variables the root element in the model --%>
<c:setVariable select="/*" var="root"/>

// Begin: custom actions prior to input annotation
// End: custom actions prior to input annotation

<%-------------------------------------------------------------------------------------------%>
<%-- Phase I - Input annotation: Navigate over model and compute derived attribute values. --%>
<%-------------------------------------------------------------------------------------------%>
<%-- NOTE: The order of calculations can be changed in the JET Authoring Editor:
       1) Click the 'Sort on calculation order' tool icon.
       2) Drag derived attributes within the schema and actions tree.
--%>

<%-- derived attributes for $root --%>
<%-- begin custom variables for $root (1) --%>
<%-- end custom variables for $root (1) --%>

<c:iterate select="$root/editor" var="editor">
  <%-- derived attributes for $editor --%>
  <%-- begin custom variables for $editor (1) --%>
  <%-- end custom variables for $editor (1) --%>

  <c:set select="$editor" name="editorProjectName"><%--@generated--%><c:get select="$editor/@id"/></c:set>
  <c:set select="$editor" name="editorPackage"><%--@generated--%><c:get select="$editor/@id"/>.editor</c:set>
  <c:set select="$editor" name="editorDir"><%--@generated--%><c:get select="translate($editor/@editorPackage,'.','/')"/></c:set>
  <c:set select="$editor" name="basePackage"><%--@generated--%><c:get select="$editor/@id"/></c:set>
  <c:set select="$editor" name="baseDir"><%--@generated--%><c:get select="translate($editor/@basePackage,'.','/')"/></c:set>
  <c:set select="$editor" name="domainPackage"><%--@generated--%><c:get select="$editor/@id"/>.domain</c:set>
  <c:set select="$editor" name="domainDir"><%--@generated--%><c:get select="translate($editor/@domainPackage,'.','/')"/></c:set>
  <c:set select="$editor" name="constraintPackage"><%--@generated--%><c:get select="$editor/@basePackage"/>.constraint</c:set>
  <c:set select="$editor" name="constraintDir"><%--@generated--%><c:get select="translate($editor/@constraintPackage,'.','/')"/></c:set>
  <c:set select="$editor" name="indexPackage"><%--@generated--%><c:get select="$editor/@basePackage"/>.index</c:set>
  <c:set select="$editor" name="indexDir"><%--@generated--%><c:get select="translate($editor/@indexPackage,'.','/')"/></c:set>
  <c:set select="$editor" name="shinglesPackage"><%--@generated--%><c:get select="$editor/@basePackage"/>.shingles</c:set>
  <c:set select="$editor" name="shinglesDir"><%--@generated--%><c:get select="translate($editor/@shinglesPackage,'.','/')"/></c:set>
  <c:set select="$editor" name="maxLevel"><%--@generated--%>4</c:set>
  <%-- begin custom variables for $editor (2) --%>
  <%-- end custom variables for $editor (2) --%>
  <c:iterate select="$editor/type" var="type">
    <%-- derived attributes for $type --%>
    <%-- begin custom variables for $type (1) --%>
    <%-- end custom variables for $type (1) --%>

    <c:set select="$type" name="validatorClass"><%--@generated--%><c:get select="uppercaseFirst($type/@name)"/>ConstraintValidator</c:set>
    <c:set select="$type" name="indexClass"><%--@generated--%><c:get select="uppercaseFirst($type/@name)"/>Index</c:set>
    <c:set select="$type" name="shingleClass"><%--@generated--%><c:get select="uppercaseFirst($type/@name)"/>Shingle</c:set>
    <c:set select="$type" name="shingleGetterMethod"><%--@generated--%>get<c:get select="uppercaseFirst($type/@name)"/>Shingle</c:set>
    <c:set select="$type" name="indexVar"><%--@generated--%>index_<c:get select="$type/@name"/></c:set>
    <c:set select="$type" name="indexGetterMethod"><%--@generated--%>get<c:get select="uppercaseFirst($type/@name)"/>Index</c:set>
    <c:set select="$type" name="shingleVar"><%--@generated--%>shingle<c:get select="uppercaseFirst($type/@name)"/></c:set>
    <c:set select="$type" name="level"><%--@generated--%>0</c:set>
    <%-- begin custom variables for $type (2) --%>
    <%-- end custom variables for $type (2) --%>
    <c:iterate select="$type/field" var="field">
      <%-- derived attributes for $field --%>
      <%-- begin custom variables for $field (1) --%>
      <%-- end custom variables for $field (1) --%>

      <c:set select="$field" name="widgetVar"><%--@generated--%>text_<c:get select="$field/@name"/></c:set>
      <c:set select="$field" name="listenerClass"><%--@generated--%><c:get select="uppercaseFirst($field/@kind)"/><c:get select="uppercaseFirst($field/@name)"/>Listener</c:set>
      <c:set select="$field" name="domainVar"><%--@generated--%>domain_<c:get select="$field/@name"/></c:set>
      <%-- begin custom variables for $field (2) --%>
      <%-- end custom variables for $field (2) --%>
      <c:iterate select="$field/constraint" var="constraint">
        <%-- derived attributes for $constraint --%>
        <%-- begin custom variables for $constraint (1) --%>
        <%-- end custom variables for $constraint (1) --%>

      </c:iterate>
      <%-- begin custom variables for $field (3) --%>
      <%-- end custom variables for $field (3) --%>
    </c:iterate>
    <%-- begin custom variables for $type (3) --%>
    <%-- end custom variables for $type (3) --%>
  </c:iterate>
  <c:iterate select="$editor/domain" var="domain">
    <%-- derived attributes for $domain --%>
    <%-- begin custom variables for $domain (1) --%>
    <%-- end custom variables for $domain (1) --%>

    <c:set select="$domain" name="domainClass"><%--@generated--%><c:get select="uppercaseFirst($domain/@name)"/>Domain</c:set>
    <%-- begin custom variables for $domain (2) --%>
    <%-- end custom variables for $domain (2) --%>
    <c:iterate select="$domain/value" var="value">
      <%-- derived attributes for $value --%>
      <%-- begin custom variables for $value (1) --%>
      <%-- end custom variables for $value (1) --%>

    </c:iterate>
    <c:iterate select="$domain/query" var="query">
      <%-- derived attributes for $query --%>
      <%-- begin custom variables for $query (1) --%>
      <%-- end custom variables for $query (1) --%>

    </c:iterate>
    <%-- begin custom variables for $domain (3) --%>
    <%-- end custom variables for $domain (3) --%>
  </c:iterate>
  <c:iterate select="$editor/pattern" var="pattern">
    <%-- derived attributes for $pattern --%>
    <%-- begin custom variables for $pattern (1) --%>
    <%-- end custom variables for $pattern (1) --%>

  </c:iterate>
  <%-- begin custom variables for $editor (3) --%>
	  	<c:setVariable select="$editor/type[not(@parent)]" var="current" />
		<c:include template="templates/editor/recurse.level.jet"/>    
  <%-- end custom variables for $editor (3) --%>
</c:iterate>
<%-- begin custom variables for $root (3) --%>
<%-- end custom variables for $root (3) --%>

// Begin: custom actions after input annotation
// End: custom actions after input annotation


<%--------------------------------------------------------------------------%>
<%-- Phase II - Action execution: Navigate over model and perform actions --%>
<%--------------------------------------------------------------------------%>
<%-- NOTE: The order of actions can be changed in the JET Authoring Editor:
       1) Click the 'Sort on calculation order' tool icon.
       2) Drag actions within the schema and actions tree.
--%>

<%-- actions for $root --%>
<%-- Begin: custom actions for $root (1) --%>
<%-- End: custom actions for $root (1) --%>

<c:iterate select="$root/editor" var="editor">
  <%-- actions for $editor --%>
  <%-- Begin: custom actions for $editor (1) --%>
  <%-- End: custom actions for $editor (1) --%>

  <ws:project name="{$editor/@editorProjectName}"/>
  <ws:file path="{$editor/@editorProjectName}/.classpath" replace="true" template="templates/editor/editor.classpath.jet"/>
  <ws:file path="{$editor/@editorProjectName}/.project" replace="true" template="templates/editor/editor.project.jet"/>
  <ws:file path="{$editor/@editorProjectName}/META-INF/MANIFEST.MF" replace="true" template="templates/editor/editor.manifest.mf.jet"/>
  <ws:file path="{$editor/@editorProjectName}/build.properties" replace="true" template="templates/editor/editor.build.properties.jet"/>
  <ws:copyFile binary="true" src="templates/editor/editor.copy.ico" target="{$editor/@editorProjectName}/icons/copy.ico"/>
  <ws:copyFile binary="true" src="templates/editor/editor.delete.ico" target="{$editor/@editorProjectName}/icons/delete.ico"/>
  <ws:copyFile binary="true" src="templates/editor/editor.down.ico" target="{$editor/@editorProjectName}/icons/down.ico"/>
  <ws:copyFile binary="true" src="templates/editor/editor.edit.ico" target="{$editor/@editorProjectName}/icons/edit.ico"/>
  <ws:copyFile binary="true" src="templates/editor/editor.shingle.ico" target="{$editor/@editorProjectName}/icons/shingle.ico"/>
  <ws:copyFile binary="true" src="templates/editor/editor.up.ico" target="{$editor/@editorProjectName}/icons/up.ico"/>
  <ws:file path="{$editor/@editorProjectName}/plugin.xml" replace="true" template="templates/editor/editor.plugin.xml.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@baseDir}/Activator.java" replace="true" template="templates/editor/editor.activator.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/AbstractConstraint.java" replace="true" template="templates/editor/editor.abstract.constraint.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/AbstractEnumeration.java" replace="true" template="templates/editor/editor.abstract.enumeration.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/AbstractIndex.java" replace="true" template="templates/editor/editor.abstract.index.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/AbstractShingle.java" replace="true" template="templates/editor/editor.abstract.shingle.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/ActionsList.java" replace="true" template="templates/editor/editor.actions.list.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/ConstraintFailure.java" replace="true" template="templates/editor/editor.constraint.failure.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/DataReader.java" replace="true" template="templates/editor/editor.data.reader.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/DataWriter.java" replace="true" template="templates/editor/editor.data.writer.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/ErrorList.java" replace="true" template="templates/editor/editor.error.list.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/IModelChangedListener.java" replace="true" template="templates/editor/editor.imodel.changed.listener.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/ModelAccess.java" replace="true" template="templates/editor/editor.model.access.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/src/{$editor/@editorDir}/ShingleEditor.java" replace="true" template="templates/editor/editor.shingle.editor.java.jet"/>
  <ws:file path="{$editor/@editorProjectName}/snippets/m2m.txt" replace="true" template="templates/editor/m2m.snippets.jet"/>

  <%-- Begin: custom actions for $editor (2) --%>
  <%-- End: custom actions for $editor (2) --%>
  <c:iterate select="$editor/type" var="type">
    <%-- actions for $type --%>
    <%-- Begin: custom actions for $type (1) --%>
    <%-- End: custom actions for $type (1) --%>

    <ws:file path="{$editor/@editorProjectName}/src/{$editor/@constraintDir}/{$type/@validatorClass}.java" replace="true" template="templates/type/type.constraint.validator.java.jet"/>
    <ws:file path="{$editor/@editorProjectName}/src/{$editor/@indexDir}/{$type/@indexClass}.java" replace="true" template="templates/type/type.index.java.jet"/>
    <ws:file path="{$editor/@editorProjectName}/src/{$editor/@shinglesDir}/{$type/@shingleClass}.java" replace="true" template="templates/type/type.shingle.java.jet"/>

    <%-- Begin: custom actions for $type (2) --%>
    <%-- End: custom actions for $type (2) --%>
    <c:iterate select="$type/field" var="field">
      <%-- actions for $field --%>
      <%-- Begin: custom actions for $field (1) --%>
      <%-- End: custom actions for $field (1) --%>

      <c:iterate select="$field/constraint" var="constraint">
        <%-- actions for $constraint --%>
        <%-- Begin: custom actions for $constraint (1) --%>
        <%-- End: custom actions for $constraint (1) --%>

      </c:iterate>

      <%-- Begin: custom actions for $field (3) --%>
      <%-- End: custom actions for $field (3) --%>
    </c:iterate>

    <%-- Begin: custom actions for $type (3) --%>
    <%-- End: custom actions for $type (3) --%>
  </c:iterate>
  <c:iterate select="$editor/domain" var="domain">
    <%-- actions for $domain --%>
    <%-- Begin: custom actions for $domain (1) --%>
    <%-- End: custom actions for $domain (1) --%>

    <ws:file path="{$editor/@editorProjectName}/src/{$editor/@domainDir}/{$domain/@domainClass}.java" replace="true" template="templates/domain/domain.java.jet"/>

    <%-- Begin: custom actions for $domain (2) --%>
    <%-- End: custom actions for $domain (2) --%>
    <c:iterate select="$domain/value" var="value">
      <%-- actions for $value --%>
      <%-- Begin: custom actions for $value (1) --%>
      <%-- End: custom actions for $value (1) --%>

    </c:iterate>
    <c:iterate select="$domain/query" var="query">
      <%-- actions for $query --%>
      <%-- Begin: custom actions for $query (1) --%>
      <%-- End: custom actions for $query (1) --%>

    </c:iterate>

    <%-- Begin: custom actions for $domain (3) --%>
    <%-- End: custom actions for $domain (3) --%>
  </c:iterate>
  <c:iterate select="$editor/pattern" var="pattern">
    <%-- actions for $pattern --%>
    <%-- Begin: custom actions for $pattern (1) --%>
    <%-- End: custom actions for $pattern (1) --%>

  </c:iterate>

  <%-- Begin: custom actions for $editor (3) --%>
  <%-- End: custom actions for $editor (3) --%>
</c:iterate>

<%-- Begin: custom actions for $root (3) --%>
<%-- End: custom actions for $root (3) --%>

<%-- Begin: final custom actions  --%>
<c:if test="isVariableDefined('org.eclipse.jet.resource.project.name')">
  <ws:file template="templates/dump.jet" path="{$org.eclipse.jet.resource.project.name}/dump.xml"/>
</c:if>
<%-- End: final custom actions --%>
